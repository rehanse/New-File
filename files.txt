Got it üëç
From your screenshots, I see the first image is the current design (popover with formula input) and you want to make it look like the second image (Excel-like popup formula editor aligned to the column, with a clean input box and OK/Cancel buttons at the bottom).

I‚Äôll rewrite your Angular template (HTML) and provide CSS so that the formula editor looks like your second screenshot.


---

‚úÖ Updated Angular HTML

<div appDisableControl [condition]="isRetReadOnly" [alwaysEnabledClass]="'btn-secondary'">

  <!-- fx trigger -->
  <a [matMenuTriggerFor]="fxMenu" #menuTrigger="matMenuTrigger" class="fx-anchor-top-right"
     (click)="opened.emit(); $event.stopPropagation();">
    <span [ngClass]="rowFormGroup?.get(formulaControlName)?.value ? 'fx-icon-blue': 'fx-icon-gray'">
      fx
    </span>
  </a>

  <!-- Formula Popup -->
  <mat-menu #fxMenu="matMenu" class="fx-popover-menu" yPosition="below" xPosition="after" [overlapTrigger]="false" [hasBackdrop]="false">
    <div class="fx-popup-container" (click)="$event.stopPropagation()">

      <!-- Formula Input -->
      <mat-form-field appearance="outline" class="fx-input-field">
        <input matInput type="text"
               #inputRef
               [formControl]="formulaControl"
               [value]="rowFormGroup?.get(formulaControlName)?.value"
               [mentionConfig]="mentionConfig"
               [mentionListTemplate]="mentionListTemplate"
               placeholder="Type @"
               class="formula-input" />
        <ng-template #mentionListTemplate let-item="item">
          <span>{{ item.columnName }}</span>
        </ng-template>
      </mat-form-field>

      <!-- Action buttons -->
      <div class="fx-actions">
        <button mat-stroked-button color="primary" (click)="onok()">Ok</button>
        <button mat-stroked-button color="warn" (click)="onCancel()">Cancel</button>
      </div>
    </div>
  </mat-menu>
</div>


---

‚úÖ CSS (formula popup like second screenshot)

/* container look */
.fx-popup-container {
  background: #fff;
  border: 1px solid #d1d1d1;
  border-radius: 6px;
  padding: 12px;
  width: 350px; /* set width like in 2nd screenshot */
  box-shadow: 0px 2px 8px rgba(0,0,0,0.15);
  display: flex;
  flex-direction: column;
  gap: 10px;
}

/* input box */
.fx-input-field {
  width: 100%;
}

.formula-input {
  font-family: monospace;
  font-size: 14px;
  padding: 6px;
}

/* action buttons */
.fx-actions {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

.fx-actions button {
  min-width: 70px;
  border-radius: 4px;
}

/* fx icon trigger */
.fx-anchor-top-right {
  text-decoration: none;
  cursor: pointer;
}

.fx-icon-blue {
  color: #1976d2;
  font-weight: bold;
}

.fx-icon-gray {
  color: gray;
}


---

üîë Key Improvements

1. Popup looks like Excel formula editor ‚Üí box with white background, shadow, and border.


2. Input field styled monospace ‚Üí makes formula text more readable.


3. Ok / Cancel buttons at bottom-right ‚Üí similar to screenshot 2.


4. Better spacing and alignment with flex + gap.




---

üëâ Do you want me to also auto-focus the input when the popup opens (like Excel does), so the user can start typing formula immediately?

