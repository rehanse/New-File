beforeEach(async () => {
    reToolServiceMock = jasmine.createSpyObj('ReToolService', ['generateFormElementIdAttribute']);
    reToolServiceMock.generateFormElementIdAttribute.and.callFake((rowIndex: number, dataId: number, columnName: string, popUp?: string) => {
        return `row-${rowIndex}_dataKey-${dataId}_${columnName}`;
    });

    reToolTabServiceMock = jasmine.createSpyObj('ReToolTabService', ['reviewRequestId', 'emit', 'showErrorMessage', 'actionStateChange']);
    reToolTabServiceMock.hasFormChange$ = new BehaviorSubject<boolean>(false);

    await TestBed.configureTestingModule({
        declarations: [NormalLossExpectancyComponent],
        schemas: [NO_ERRORS_SCHEMA],
        imports: [
            ReactiveFormsModule,
            MatTableModule,
            HttpClientTestingModule,
            ToastrModule.forRoot()
        ],
        providers: [
            FormBuilder,
            { provide: ReToolService, useValue: reToolServiceMock },
            { provide: ReToolTabService, useValue: reToolTabServiceMock }
        ]
    }).compileComponents();

    fixture = TestBed.createComponent(NormalLossExpectancyComponent);
    component = fixture.componentInstance;
    component.showHideColumn = showHideColumns;
    component.normalLossExpectancyForm = new FormGroup({
        rows: new FormArray([
            new FormGroup({
                NormalLossScenario: new FormControl("test scenario", Validators.required),
                NormalLossDeficiencyDriven: new FormControl(true, Validators.required)
            })
        ])
    });

    fixture.detectChanges();
});

it("should call emit onSaveFormData when form is valid", fakeAsync(() => {
    // No need to redefine spyOn since it's already in beforeEach()
    component.normalLossExpectancyForm.markAllAsTouched();
    component.normalLossExpectancyForm.updateValueAndValidity();
    component.onSubmit();

    expect(reToolTabServiceMock.emit).toHaveBeenCalledWith('onSaveFormData', {
        formData: component['getNormalExpectancyFormData'],
        subTabIndex: 0
    });
}));
----------------------------
