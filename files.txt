it('should handle occupancy type change', fakeAsync(() => {
    // 1. Initialize component with proper form structure
    component.ngOnInit();
    tick();
    fixture.detectChanges();

    // 2. Set up mock responses and initial data
    const mockTypes = [{
        value: 'type1',
        dependentValue: {
            occupancyTypeCode: 'code1',
            hazard: 'Low',
            equipmentBreakdown: 'High'
        }
    }];
    
    // Mock the occupancy type service call
    mockReToolService.getOccupancyType.and.returnValue(of(mockTypes));

    // 3. Simulate initial group selection
    component.changeOccupancyGroup(0, '1');
    tick();

    // 4. Get reference to the form row
    const formArray = component['getFormArray']();
    const row = formArray.at(0) as FormGroup;

    // 5. Set initial values for the test
    row.patchValue({
        OccupancyGroup: '1',
        OccupancyType: 'type1',
        Action: ActionEnum.IsSaved
    });

    // 6. Execute the type change
    component.changeOccupancyType(0, 'type1');
    tick();

    // 7. Verify the updates
    expect(row.get('Hazard').value).toBe('Low');
    expect(row.get('EquipmentBreakdown').value).toBe('High');
    expect(row.get('OccupancyCode').value).toBe('code1');
    expect(row.get('Action').value).toBe(ActionEnum.IsModified);
}));
