import { Component } from '@angular/core';
import { ReToolService } from './services/re-tool.service'; // Adjust path
import { HttpEventType } from '@angular/common/http';

@Component({
  selector: 'app-my-editor',
  templateUrl: './my-editor.component.html'
})
export class MyEditorComponent {
  public editorContent = '';
  public editorOptions: Object;

  constructor(private reToolService: ReToolService) {
    this.editorOptions = {
      attribution: false,
      toolbarButtons: ['insertImage', 'insertTable', 'specialCharacters'],
      imageAllowedTypes: ['jpeg', 'jpg', 'png'],
      events: {
        'image.beforeUpload': this.customImageUpload.bind(this)
      }
    };
  }

  customImageUpload(files: File[]) {
    if (files.length === 0) return;

    const file = files[0];
    const formData = new FormData();
    formData.append('file', file); // Adjust the key if your backend expects something else

    this.reToolService.UploadImage(formData).subscribe({
      next: (response: any) => {
        // Assuming the API returns the image URL
        const imageUrl = response.imageUrl || response.url || response; // adapt to your API
        // Insert image into Froala
        (window as any).FroalaEditor.INSTANCES[0].image.insert(imageUrl, true, null, this.editorOptions);
      },
      error: (error) => {
        console.error('Image upload failed:', error);
      }
    });
  }
}
